# 2023-12-08 Thinking about the user data model

The app has users and accounts.

A user represents a person who has signed up on Quickbyte. A user can login to the app to access their resources. Sign up and authentication is currently handled by [Microsoft Entra ID for Customers](https://learn.microsoft.com/en-us/entra/external-id/customers/). There's a Microsoft Entra ID tenant that stores user records and allows them to authenticate to the app. The app also stores user information in the `users` collection of the database. The `users` collection has an `aadId` field that corresponds to the ID of the user record in the Microsoft Entra ID tenant.

An account is used to handle subscription and billing. I decided to store accounts separately from users so that it would easier to model scenarios where one user invites their collaborators under a single account that the owner pays for. Each account has an owner. Subscriptions are tied to an account, not a user. And all the resources within a subscription are tied to that account as well. At the moment, I only envision ever having one subscription per account. But eventually it may be possible to have multiple accounts. The resources within an account should become inaccessible when the subscription is no longer active (unless those resources are designed to be free to access). A subscription is an instance of a subscription plan. The plan defines what features and limits are available. A subscription ties a plan and billing cycle to an account. The subscription is kept in sync with the payment provider.

Besides users, Quickbyte also supports guests. Guests are people who have limited access to resources within a Quickbyte account upon the invitations of the account admin (or a user with sufficient permissions). The main difference between "guests" and "users" is that guests have not signed up to Quickbyte. Therefore, they cannot login, they do not have an account and they're not tracked in Microsoft Entra ID. Guests can only access the resources they've been invited to. They're identified by their email address. How should we track them in the database? Should we have a collection of "guests"? I two different users invite the same person using the same email address to two different projects, should the system recognize the person as the same guest? If the guest eventually creates an account with the same email address should their "guest activity" history be "merged" to their new user account? If the latter is true, then we can store the guests in the users collection but add a flag indicating that they're guests and should be treated differently.