# 2024-03-14 Introduce support for folders

Time has finally come to implement folder support to organize files. Customers have started asking for it.

Implementing folder support should be straightforward. A folder is a record in a `folders` collection that has a `name` and `_id` and a `parentId`. 
Each media record could have a nullable `folderId`. When `media.folderId` is not set, then the file is at the root, otherwise the file belongs to the specified folder.
Root folders have an empty (null/undefined) `parentId`. Subfolders have a `parentId` that links to the parent folder.

We should have an endpoint that returns the root items of a project, that includes root folders and root media items. We should have an endpoint that returns the items of a specific path, where a path is slash-separated sequence of folder ids. It could be a sequence of folder names, which is probably more user-friendly, but folder names can be changed, this might make a previously shared URLs invalid.

When a folder is deleted. It's children should be deleted as well. Not sure whether to actually mark all the children as deleted, or only mark the folder record as deleted, but make sure we can't access children of a deleted parent. That means we should prevent fetching an media item by id, and only allow it to be fetched by path.
This might lead to really long media URLs. And media URL that has been shared, will become invalid after that media file has been moved.
On the other hand, marking an entire folder sub-tree as deleted could be expensive. But we could schedule it to a background job.

I should point out that folders allow you to organize media items in a project, but the file records that back up a media item are independent of folders.
Currently file records that back media items are still an implementation detail that are transparent to users. Now this brings an interesting concern, when
uploading folders using the Quick Transfer page, folder paths are retained in the file names. I wasn't sure how to handle this when I implemented project media
so I cheated by not providing an option to upload folders to a project. Now that we're implementing folder support, it should be natural to allow uploading or drag-and-dropping folders.

The easiest way to handle this right now, would be to keep treating transfer files the way they are currently treated: their file names include the folder paths they were uploaded from. Then when the transfer is finalized and we have to create media items, we reconstruct the folder hiearchy from the file paths and store the corresponding folders in the database then map each folder path to the corresponding folder record id and assign those to media items when they are stored in the DB.
Once the media item has been created in the right folder, moving it to a different folder would be a matter of changing the `folderId`.